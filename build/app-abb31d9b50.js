"use strict";!function(){var t={},e=function(){d3.selectAll(".you-draw-it").each(function(){var e=d3.select(this),a=this.dataset.key,r=window.ydi_data[a],n=r.data,i=Object.keys(n).map(function(t){return{year:Number(t),value:n[t]}});if(t[a]||(t[a]={}),i.length<1)return void console.log("No data available for:",a);var s=window.innerWidth<760,l=i[0].year,d=i[i.length-1].year,o=[{year:2002,class:"black",title:""},{year:2010,class:"red",title:"I. Amtszeit\nDieter Salomon"},{year:Math.min(2018,d),class:"red",title:"II. Amtszeit\nDieter Salomon"}],c=o[o.length-2].year,p=d3.min(i,function(t){return t.value}),u=d3.max(i,function(t){return t.value}),h=[l].concat(o.map(function(t){return t.year})),f=function(){for(var t=arguments,e=0;e<t.length;e++)"string"!=typeof t[e]&&"number"!=typeof t[e]||(t[e]=function(t){return function(e){return e[t]}}(t[e]));return function(e){for(var a=0,r=t.length;a++<r;)e=t[a-1].call(this,e);return e}},y=function(t){t.axis.append("g").attr("class","x axis").attr("transform","translate(0,"+t.height+")").call(t.xAxis),S<0&&t.axis.append("g").classed("nullaxis",!0).attr("transform","translate(0,"+t.y(0)+")").call(d3.axisBottom(t.x).tickValues([]).tickSize(0)),t.axis.append("text").text("0").attr("transform","translate(-15, "+(t.y(0)+5)+")")},g=function(t,e){var a=r.precision?Number(t).toFixed(r.precision):e?Number(t).toFixed(e):t;return String(a).replace(".",",")+(r.unit?" "+r.unit:"")},x=function(t,e){var a=L.x(t),r=L.y(n[t]),i=g(n[t]),o=L.labels.append("div").classed("data-label",!0).classed(e,!0).style("left",a+"px").style("top",r+"px");return o.append("span").text(i),t==l&&s&&o.classed("edge-left",!0),t==d&&s&&o.classed("edge-right",!0),[L.dots.append("circle").attr("r",4.5).attr("cx",a).attr("cy",r).attr("class",e),o]},v=function(t,e,a){var r=function(a,r){return a.year>=t&&a.year<=e},n=d3.area().x(f("year",L.x)).y0(f("value",L.y)).y1(L.height).defined(r),s=d3.area().x(f("year",L.x)).y(f("value",L.y)).defined(r);t==l&&x(l,a);var d=a+(e==c?" median":""),o=L.charts.append("g");return o.append("path").attr("d",n(i)).attr("class","area "+d).attr("fill","url(#gradient-"+a+")"),o.append("path").attr("d",s(i)).attr("class","line "+d),[o].concat(x(e,d))},m=function(t,e,a){return Math.max(t,Math.min(e,a))};e.html("");var w={top:20,right:s?20:50,bottom:20,left:s?20:50},b=e.node().offsetWidth,k=400,L={width:b-(w.left+w.right),height:k-(w.top+w.bottom)},S=Math.min(p,0),D=Math.max(2*n[c],u+.4*(u-S));L.x=d3.scaleLinear().range([0,L.width]),L.x.domain([l,d]),L.y=d3.scaleLinear().range([L.height,0]),L.y.domain([S,D]),L.svg=e.append("svg").attr("width",b).attr("height",k).append("g").attr("transform","translate("+w.left+","+w.top+")").attr("width",L.width).attr("height",L.height),L.defs=d3.select(L.svg.node().parentNode).append("defs"),["black","red"].forEach(function(t){var e=L.defs.append("linearGradient").attr("id","gradient-"+t).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");e.append("stop").attr("offset","0%").attr("class","start"),e.append("stop").attr("offset","100%").attr("class","end")}),L.defs.append("marker").attr("id","preview-arrow").attr("orient","auto").attr("markerWidth",2).attr("markerHeight",4).attr("refX",.1).attr("refY",2).append("path").attr("d","M0,0 V4 L2,2 Z"),L.grid=L.svg.append("g").attr("class","grid"),L.grid.append("g").attr("class","horizontal").call(d3.axisBottom(L.x).tickValues(L.x.ticks(d-l)).tickFormat("").tickSize(L.height)).selectAll("line").attr("class",function(t,e){return h.indexOf(t)!==-1?"highlight":""}),L.grid.append("g").attr("class","vertical").call(d3.axisLeft(L.y).tickValues(L.y.ticks(6)).tickFormat("").tickSize(-L.width));var M=function(t){t.style("left",w.left+"px").style("top",w.top+"px").style("width",L.width+"px").style("height",L.height+"px")},A=L.svg.append("rect").attr("class","draggable").attr("x",L.x(c)).attr("width",L.x(d)-L.x(c)).attr("height",L.height).attr("opacity",0);setTimeout(function(){var t=L.svg.node().getBoundingClientRect();L.top=t.top+window.scrollY,L.bottom=t.bottom+window.scrollY},1e3),L.labels=e.append("div").attr("class","labels").call(M),L.axis=L.svg.append("g"),L.charts=L.svg.append("g"),L.preview=L.svg.append("line").attr("class","preview-line").attr("marker-end","url(#preview-arrow)").attr("x1",L.x(c)).attr("y1",L.y(n[c])).attr("x2",L.x(c)+50).attr("y2",L.y(n[c]));var z=L.svg.append("path").attr("class","your-line");L.dots=L.svg.append("g").attr("class","dots"),L.xAxis=d3.axisBottom().scale(L.x),L.xAxis.tickFormat(function(t){return"'"+String(t).substr(2)}).ticks(d-l),y(L),L.titles=e.append("div").attr("class","titles").call(M),L.controls=e.append("div").attr("class","controls").call(M).style("padding-left",L.x(c)+"px"),L.controls.append("div").attr("class","box").text("Zeichnen Sie die Linie zu Ende");var E=o.map(function(t,e){var a=e>0?o[e-1].year:l,r=t.year;return L.titles.append("span").style("left",L.x(a)+"px").style("width",L.x(r)-L.x(a)+"px").text(t.title),v(a,r,t.class)}),F=E[E.length-1][0],N=L.charts.append("clipPath").attr("id","result-clip-"+a).append("rect").attr("width",L.x(c)).attr("height",L.height),B=E[E.length-1].slice(1,3);F.attr("clip-path","url(#result-clip-"+a+")").append("rect").attr("width",L.width).attr("height",L.height).attr("fill","none"),B.map(function(t){return t.style("opacity",0)});var T=d3.line().x(f("year",L.x)).y(f("value",L.y));t[a].yourData||(t[a].yourData=i.map(function(t){return{year:t.year,value:n[c],defined:0}}).filter(function(t){return t.year==c&&(t.defined=!0),t.year>=c}));var V=d3.select(".result."+a),I=function(){z.attr("d",T.defined(f("defined"))(t[a].yourData));var e=t[a].yourData[t[a].yourData.length-1];if(e.defined){var r=L.labels.selectAll(".your-result").data([e]);r.enter().append("div").classed("data-label your-result",!0).classed("edge-right",s).merge(r).style("left",function(){return L.x(d)+"px"}).style("top",function(t){return L.y(t.value)+"px"}).html("").append("span").text(function(t){return g(t.value,2)})}};I();var O=function(){if(!t[a].resultShown){e.node().classList.add("drawn");var r=d3.mouse(L.svg.node()),n=m(c,d,L.x.invert(r[0])),i=m(L.y.domain()[0],L.y.domain()[1],L.y.invert(r[1]));t[a].yourData.forEach(function(t){t.year>c&&(Math.abs(t.year-n)<.5&&(t.value=i),t.year-n<.5&&(t.defined=!0))}),I(),t[a].completed||1!=d3.mean(t[a].yourData,f("defined"))||(t[a].completed=!0,V.node().classList.add("finished"),V.select("button").node().removeAttribute("disabled"))}};L.svg.call(d3.drag().on("drag",O)),L.svg.on("click",O);var W=function(){t[a].completed&&(t[a].resultShown=!0,N.transition().duration(700).attr("width",L.x(d)),A.attr("class",""),setTimeout(function(){B.map(function(t){return t.style("opacity",1)}),V.node().classList.add("shown")},700))};V.select("button").on("click",W),t[a].resultShown&&W(),e.on("mousemove",function(){var t=d3.mouse(L.svg.node()),e=Math.min(Math.max(t[1],L.y(D)),L.y(S));L.preview.attr("y2",e)})})};document.addEventListener("DOMContentLoaded",e);var a=function(t,e,a){var r=void 0;return function(){var n=this,i=arguments,s=function(){r=null,a||t.apply(n,i)},l=a&&!r;clearTimeout(r),r=setTimeout(s,e),l&&t.apply(n,i)}};window.addEventListener("resize",a(function(){e()},500))}();